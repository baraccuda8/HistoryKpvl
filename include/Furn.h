#pragma once

namespace S107
{
    typedef struct T_cass{
        int id = 0;
        std::string Run_at = "";
        std::string End_at = "";
        std::string Err_at = "";
        int Day = 0;
        int Month = 0;
        int Year = 0;
        int CassetteNo = 0;
    };

    extern std::string URI;
    extern std::string ServerDataTime;

    namespace Coll{
        extern int Create_at;
        extern int Id;
        extern int Event;
        extern int Day;
        extern int Month;
        extern int Year;
        extern int CassetteNo;
        extern int SheetInCassette;
        extern int Close_at;
        extern int Peth;
        extern int Run_at;
        extern int Error_at;
        extern int End_at;
        extern int Delete_at;
        extern int TempRef;           //Заданное значение температуры
        extern int PointTime_1;       //Время разгона
        extern int PointRef_1;        //Уставка температуры
        extern int TimeProcSet;       //Полное время процесса (уставка), мин
        extern int PointDTime_2;      //Время выдержки
        extern int f_temper;          //Факт температуры за 5 минут до конца отпуска
        extern int Finish_a;
    };

    void GetColl(PGresult* res);
    void GetCassette(PGresult* res, TCassette& cassette, int line);


    namespace SQL{
        void FURN_SQL(PGConnection& conn, std::deque<TCassette>& allCassette);
        void GetIsPos(PGConnection& conn, TCassette& CD);
        bool GetCountSheet(PGConnection& conn, TCassette& CD);
    };


#pragma region Функции с кассетами в базе
    bool IsCassete(TCassette& CD);
    bool IsCassete1(T_cassette& CD);
    bool IsCassete2(T_cassette& CD);

    void UpdateCassetteProcRun(PGConnection& conn, T_ForBase_RelFurn& Furn, int Peth);
    void UpdateCassetteProcEnd(PGConnection& conn, T_ForBase_RelFurn& Furn, int Peth);
    void UpdateCassetteProcError(PGConnection& conn, T_ForBase_RelFurn& Furn, int Peth);
    void SetTemperCassette(PGConnection& conn, T_cassette& CD, std::string teper);;
    void CloseAllCassette2(PGConnection& conn, T_cassette& CD, int Peth);
#pragma endregion

    //Печ отпуска #1
    namespace Furn1{
        extern T_cass Petch;

        DWORD Data_WDG_toBase(Value* value);

        //BOOL Работа
        DWORD ProcRun(Value* value);

        //BOOL Окончание процесса
        DWORD ProcEnd(Value* value);

        //BOOL Авария процесса
        DWORD ProcError(Value* value);

        //Обнуление температуры для сравнения
        //DWORD SetNull_Temper(Value* value);

        DWORD Day(Value* value);
        DWORD Month(Value* value);
        DWORD Year(Value* value);
        DWORD No(Value* value);


        DWORD TimeHeatAcc(Value* value);
        DWORD TimeHeatWait(Value* value);
        DWORD TimeTotal(Value* value);

        ////REAL Время до окончания процесса, мин
        DWORD TimeToProcEnd(Value* value);

        ////REAL Время разгона
        //DWORD PointTime_1(Value* value);
        //
        ////REAL Уставка температуры
        //DWORD PointRef_1(Value* value);
        //
        ////REAL Время выдержки
        //DWORD PointDTime_2(Value* value);
        //
        ////REAL Полное время процесса (уставка), мин
        //DWORD TimeProcSet(Value* value);
        //
        ////REAL Время процесса, час (0..XX)
        //DWORD ProcTimeMin(Value* value);
        //
        ////REAL Заданное значение температуры
        //DWORD TempRef(Value* value);
        //
        ////REAL Фактическое значение температуры
        //DWORD TempAct(Value* value);
        //
        ////REAL Термопара 1
        //DWORD T1(Value* value);
        //
        ////REAL Термопара 2
        //DWORD T2(Value* value);
        //
        ////ID касеты
        //DWORD IDCassette(Value* value);
        //
        ////ID касеты месяц
        //DWORD Month(Value* value);
        //
        ////ID касеты день
        //DWORD Day(Value* value);
        //
        ////ID касеты номер
        //DWORD CassetteNo(Value* value);
        //
        ////Выбор
        //DWORD SelectedCassete(Value* value);

    }


    //Печ отпуска #2
    namespace Furn2{
        extern T_cass Petch;

        DWORD Data_WDG_toBase(Value* value);

        //BOOL Работа
        DWORD ProcRun(Value* value);

        //BOOL Окончание процесса
        DWORD ProcEnd(Value* value);

        //BOOL Авария процесса
        DWORD ProcError(Value* value);

        //Обнуление температуры для сравнения
        //DWORD SetNull_Temper(Value* value);

        DWORD Day(Value* value);
        DWORD Month(Value* value);
        DWORD Year(Value* value);
        DWORD No(Value* value);



        DWORD TimeHeatAcc(Value* value);
        DWORD TimeHeatWait(Value* value);
        DWORD TimeTotal(Value* value);

        ////REAL Время до окончания процесса, мин
        DWORD TimeToProcEnd(Value* value);

        ////REAL Время разгона
        //DWORD PointTime_1(Value* value);
        //
        ////REAL Уставка температуры
        //DWORD PointRef_1(Value* value);
        //
        ////REAL Время выдержки
        //DWORD PointDTime_2(Value* value);
        //
        ////REAL Полное время процесса (уставка), мин
        //DWORD TimeProcSet(Value* value);
        //
        ////REAL Время процесса, час (0..XX)
        //DWORD ProcTimeMin(Value* value);
        //
        ////REAL Заданное значение температуры
        //DWORD TempRef(Value* value);
        //
        ////REAL Фактическое значение температуры
        //DWORD TempAct(Value* value);
        //
        ////REAL Термопара 1
        //DWORD T1(Value* value);
        //
        ////REAL Термопара 2
        //DWORD T2(Value* value);
        //
        ////ID касеты год
        //DWORD Year(Value* value);
        //
        ////ID касеты месяц
        //DWORD Month(Value* value);
        //
        ////ID касеты день
        //DWORD Day(Value* value);
        //
        ////ID касеты номер
        //DWORD CassetteNo(Value* value);
        //
        ////Выбор
        //DWORD SelectedCassete(Value* value);

    };

    //DWORD SelectedCassete(Value* value);
}


void SetUpdateCassete(PGConnection& conn, TCassette& cassette, std::string update, std::string where);

